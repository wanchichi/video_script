import streamlit as st  #å¼•å…¥Streamlitåº“ï¼Œç”¨äºåˆ›å»ºWebç•Œé¢
from utils import generate_script
#ä»è‡ªå®šä¹‰çš„â€œutilsâ€æ–‡ä»¶ä¸­å¯¼å…¥generate_scriptå‡½æ•°ï¼Œç”¨äºç”Ÿæˆè„šæœ¬


st.title("ğŸ¬ è§†é¢‘è„šæœ¬ç”Ÿæˆå™¨")   #è®¾ç½®ç½‘é¡µçš„ ä¸»æ ‡é¢˜

with st.sidebar:
    openai_api_key = st.text_input("è¯·è¾“å…¥OpenAI APIå¯†é’¥ï¼š", type="password")
    st.markdown("[è·å–OpenAI APIå¯†é’¥](https://platform.openai.com/account/api-keys)")
    #åˆ›å»ºä¸€ä¸ªä¾§è¾¹æ ï¼Œç”¨æ¥è¾“å…¥ç”¨æˆ·çš„OpenAI APIå¯†é’¥ï¼Œå¯†é’¥è¾“å…¥æ¡†æ˜¯å¯†ç ç±»å‹ï¼ˆéšè—è¾“å…¥ï¼‰
    #æä¾›ä¸€ä¸ª è·å–APIå¯†é’¥çš„ è¶…é“¾æ¥ã€‚

subject = st.text_input("ğŸ’¡ è¯·è¾“å…¥è§†é¢‘çš„ä¸»é¢˜")
#åˆ›å»ºä¸€ä¸ªæ–‡æœ¬è¾“å…¥æ¡†ï¼Œç”¨æˆ·è¾“å…¥è§†é¢‘ä¸»é¢˜
video_length = st.number_input("â±ï¸ è¯·è¾“å…¥è§†é¢‘çš„å¤§è‡´æ—¶é•¿ï¼ˆå•ä½ï¼šåˆ†é’Ÿï¼‰", min_value=0.1, step=0.1)
#åˆ›å»ºä¸€ä¸ª æ•°å­—è¾“å…¥æ¡†ï¼Œç”¨æˆ·è¾“å…¥è§†é¢‘æ—¶é•¿ï¼ˆå•ä½ï¼šåˆ†é’Ÿï¼‰ï¼Œæœ€å°ä¸º0.1.
creativity = st.slider("âœ¨ è¯·è¾“å…¥è§†é¢‘è„šæœ¬çš„åˆ›é€ åŠ›ï¼ˆæ•°å­—å°è¯´æ˜æ›´ä¸¥è°¨ï¼Œæ•°å­—å¤§è¯´æ˜æ›´å¤šæ ·ï¼‰", min_value=0.0,
                       max_value=1.0, value=0.2, step=0.1)
#åˆ›å»ºä¸€ä¸ªæ»‘åŠ¨æ¡ï¼ˆ0.0--0.1ï¼‰ï¼Œç”¨äºæ§åˆ¶ç”Ÿæˆè„šæœ¬çš„â€œåˆ›é€ åŠ›â€ã€‚é»˜è®¤å€¼æ˜¯0.2ï¼Œæ•°å€¼è¶Šå¤§ï¼Œç”Ÿæˆå†…å®¹è¶Šå¤šæ ·

submit = st.button("ç”Ÿæˆè„šæœ¬")
#åˆ›å»ºä¸€ä¸ªæŒ‰é’®ï¼Œç”¨æˆ·ç‚¹å‡»åè§¦å‘è„šæœ¬ç”Ÿæˆ

if submit and not openai_api_key:
    st.info("è¯·è¾“å…¥ä½ çš„OpenAI APIå¯†é’¥")
    st.stop()
    #å¦‚æœç”¨æˆ·ç‚¹å‡»äº†æŒ‰é’®ä½†æ²¡æœ‰å¡«å†™APIå¯†é’¥ï¼Œå°±æ˜¾ç¤ºæç¤ºå¹¶åœæ­¢æ‰§è¡Œ
if submit and not subject:
    st.info("è¯·è¾“å…¥è§†é¢‘çš„ä¸»é¢˜")
    st.stop()
    #å¦‚æœç‚¹å‡»äº†æŒ‰é’®ä½†æ²¡æœ‰å¡«å…¥subjectï¼Œæç¤ºå¹¶åœæ­¢
if submit and not video_length >= 0.1:
    st.info("è§†é¢‘é•¿åº¦éœ€è¦å¤§äºæˆ–ç­‰äº0.1")
    st.stop()
    #æ£€æŸ¥è§†é¢‘æ—¶é•¿æ˜¯å¦åˆæ³•ï¼Œå¿…é¡»å¤§äºç­‰0.1
#æ ¸å¿ƒé€»è¾‘æ‰§è¡Œ
if submit:
    with st.spinner("AIæ­£åœ¨æ€è€ƒä¸­ï¼Œè¯·ç¨ç­‰..."):
        search_result, title , script = generate_script(subject, video_length, creativity, openai_api_key, model_name = "gpt-4o")
    #ç”¨æˆ·æäº¤äº†æ‰€æœ‰ä¿¡æ¯ï¼Œæ˜¾ç¤ºåŠ è½½åŠ¨ç”»
    #ä½ å®šä¹‰çš„æ˜¯å‚æ•° api_keyï¼Œä½†ä¼ è¿›å»çš„æ˜¯å˜é‡ openai_api_keyï¼Œ
    # _è¿™å®Œå…¨æ²¡é—®é¢˜â€”â€”åªè¦è¿™ä¸ªå˜é‡ openai_api_key åœ¨å½“å‰ä½œç”¨åŸŸé‡Œå·²ç»è¢«å®šä¹‰å¹¶ä¸”æ˜¯ä½ æƒ³è¦ä¼ çš„å€¼å°±è¡Œã€‚
    #è°ƒç”¨generate_scriptå‡½æ•°ï¼Œä¼ å…¥ç”¨æˆ·çš„è¾“å…¥ï¼Œç”Ÿæˆwikiæœç´¢ç»“æœï¼Œæ ‡é¢˜å’Œè„šæœ¬ã€‚
    st.success("è§†é¢‘è„šæœ¬å·²ç”Ÿæˆï¼")#æ˜¾ç¤ºè„šæœ¬ç”ŸæˆæˆåŠŸçš„æç¤º
    st.subheader("ğŸ”¥ æ ‡é¢˜ï¼š")
    st.write(title) #æ˜¾ç¤ºç”Ÿæˆçš„è§†é¢‘æ ‡é¢˜  st.write()æ˜¯ä¸‡èƒ½å±•ç¤ºå‡½æ•°
    st.subheader("ğŸ“ è§†é¢‘è„šæœ¬ï¼š")
    st.write(script) #æ˜¾ç¤ºç”Ÿæˆçš„è§†é¢‘è„šæœ¬
    with st.expander("ç»´åŸºç™¾ç§‘æœç´¢ç»“æœ ğŸ‘€"):
        st.info(search_result)  #åˆ›å»ºä¸€ä¸ªå¯å±•å¼€çš„åŒºåŸŸï¼Œæ˜¾ç¤ºç»´åŸºç™¾ç§‘çš„æœç´¢å†…å®¹ï¼Œä½œä¸ºç”Ÿæˆè„šæœ¬çš„å‚è€ƒèµ„æ–™
